
```{r}
## whatever name you assigned to your created app
appname <- "rtweet_token"

## api key (example below is not a real key)
key <- "K2xE3Zae51f3duoOF8XeeTRAz"

## api secret (example below is not a real key)
secret <- "AayxSICee13fUelX8UnTj9DXxrjegr3tHyUo7K6ExJx7lOZZKu"

## create token named "twitter_token"
twitter_token <- create_token(
    app = appname,
    consumer_key = key,
    consumer_secret = secret)
```
```{r}
library(rtweet)
library(dplyr)
library(purrr)
library(igraph)
library(ggraph)

influncerv1.2=c("UWMedicine","HarmitMalik","SeattleCCA","jonadrabi","CultPerfectMoms","heatherswifty","PergamIC","MartaDiazFonsec","End_Disparities","Rachel_Tompa","Engel140","defeatHIV","LotteSteuten","double_whammied"
)


hutch=get_followers("@fredhutch", n = 75000, parse = TRUE,
as_double = FALSE, token = NULL)

influncerv1.2=c("UWMedicine","HarmitMalik","SeattleCCA","jonadrabi","CultPerfectMoms","heatherswifty","PergamIC","MartaDiazFonsec","End_Disparities","Rachel_Tompa","Engel140","defeatHIV","LotteSteuten","double_whammied"
)



useres = lookup_users(influncerv1.2)

useres %>% select(screen_name) %>% unique() %>%  arrange(screen_name) 

user <- lookup_users(useres$screen_name)
user %>% select(dplyr::contains("count")) %>% head()


r_users_ranking <- user %>%
  filter(protected == FALSE) %>% 
  select(screen_name, dplyr::contains("count")) %>% 
  unique() %>% 
  mutate(followers_percentile = ecdf(followers_count)(followers_count),
         friends_percentile = ecdf(friends_count)(friends_count),
         listed_percentile = ecdf(listed_count)(listed_count),
         favourites_percentile = ecdf(favourites_count)(favourites_count),
         statuses_percentile = ecdf(statuses_count)(statuses_count)
         ) %>% 
  group_by(screen_name) %>% 
  summarise(top_score = followers_percentile + friends_percentile + listed_percentile + favourites_percentile + statuses_percentile) %>% 
  ungroup() %>% 
  mutate(ranking = rank(-top_score))

top_15 <- r_users_ranking %>% arrange(desc(top_score)) %>% head(16) %>% arrange(desc(top_score))
top_15 

top15_lookup <- user %>%
  filter(screen_name %in% top_15$screen_name) %>% 
  select(screen_name, user_id)

top15_lookup


top_15_usernames <- top15_lookup$screen_name





str(friends_top15)




friends_top15 <-   map(top_15_usernames[1:14 ], get_friends)
names(friends_top15) <- top_15_usernames[1:14]


str(friends_top15)


names(friends_top15) <- top_15_usernames
str(friends_top15)



friends_top15 <- map2_df(friends_top15, names(friends_top15), ~ mutate(.x, twitter_top_user = .y)) %>% 
  rename(friend_id = user_id) %>% select(twitter_top_user, friend_id)

str(friends_top15)
(friends_top15)

final_friends_top15 <- friends_top15  %>% 
  filter(friend_id %in% top15_lookup$user_id)



final_friends_top15$friend_name <- top15_lookup$screen_name[match(final_friends_top15$friend_id, top15_lookup$user_id)]

write.csv(user[,c("name","screen_name","location")], "users.csv")



final <- final_friends_top15 %>% select(-friend_id)

head(final)

final

png(file="Influncernetworkgraph.png",width=1000,height=700)
f1 <- graph_from_data_frame(final, directed = TRUE, vertices = NULL)
V(f1)$Popularity <- degree(f1, mode = 'in')

ggraph(f1, layout='kk') + 
  geom_edge_fan(aes(alpha = ..index..), show.legend = FALSE) +
  geom_node_point(aes(size = Popularity)) +
  geom_node_text(aes(label = name, fontface='bold'), 
                 color = 'white', size = 3) +
  theme_graph(background = 'dimgray', text_colour = 'white',title_size = 30)
dev.off()

cult=get_followers("CultPerfectMoms", n = 75000, page = "-1", parse = TRUE,
as_double = FALSE, token = NULL)

cult2 = lookup_users(cult)
useres %>% select(screen_name) %>% unique() %>%  arrange(screen_name) 

"UWMedicine" %in% cult2$screen_name

double=get_followers("heatherswifty", n = 75000, page = "-1", parse = TRUE,
as_double = FALSE, token = NULL)

double2=lookup_users(double)

"UWMedicine" %in% double2$screen_name


```












































